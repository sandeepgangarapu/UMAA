true_vars = c (0.132351, 0.146316, 0.159399, 0.124684, 0.112359)
grp = c(0:(length(true_means)-1))
true_df <- data.frame(grp, true_means, true_vars)
true_df <- true_df %>% mutate(grp=factor(grp))
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
non_agg_data <- fread("non_agg_bern_31_5000.csv")
# remove NA's
non_agg_data <- non_agg_data[complete.cases(non_agg_data),]
non_agg_data <- non_agg_data[, alg := ifelse(alg=="ab", "ABTesting", ifelse(alg=="thomp","THOMP", ifelse(alg=="thomp_inf", "THOMP_INF", ifelse(alg=="thomp_athey", "HADAD", ifelse(alg=="thomp_bern", "THOMP", ifelse(alg=="thomp_inf_bern", "THOMP_INF",ifelse(alg=="ab_bern", "AB", 'NONE')))))))]
group_outcome <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, group, x, ite)]
regret_mse <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, regret, ite, mean_mse, var_mse, x)]
xlimit <- max(group_outcome$x) + 500
df <- copy(group_outcome)[ite==0,] [x<2001]
grp <- ggplot(df %>% filter(alg!='HADAD')) + geom_point(aes(x=x, y=factor(group)), shape=1, alpha=0.6) +
facet_grid(alg ~.) +
labs(x='Time Period', y = 'Group') +
theme(axis.text.y = element_text(size = rel(0.7)))  +  theme_bw()
ggsave("grp.png", dpi=400, height = 4, width=8, scale = 0.8)
grp
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
non_agg_data <- fread("non_agg_bern_31_5000.csv")
# remove NA's
non_agg_data <- non_agg_data[complete.cases(non_agg_data),]
non_agg_data <- non_agg_data[, alg := ifelse(alg=="ab", "ABTesting", ifelse(alg=="thomp","THOMP", ifelse(alg=="thomp_inf", "THOMP_INF", ifelse(alg=="thomp_athey", "HADAD", ifelse(alg=="thomp_bern", "THOMP", ifelse(alg=="thomp_inf_bern", "THOMP_INF",ifelse(alg=="ab_bern", "AB", ifelse(alg=="thomp_athey_bern", "HADAD",'NONE'))))))))]
group_outcome <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, group, x, ite)]
regret_mse <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, regret, ite, mean_mse, var_mse, x)]
xlimit <- max(group_outcome$x) + 500
df <- copy(group_outcome)[ite==0,] [x<2001]
grp <- ggplot(df %>% filter(alg!='HADAD')) + geom_point(aes(x=x, y=factor(group)), shape=1, alpha=0.6) +
facet_grid(alg ~.) +
labs(x='Time Period', y = 'Group') +
theme(axis.text.y = element_text(size = rel(0.7)))  +  theme_bw()
ggsave("grp.png", dpi=400, height = 4, width=8, scale = 0.8)
grp
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
non_agg_data <- fread("non_agg_bern_31_5000.csv")
# remove NA's
non_agg_data <- non_agg_data[complete.cases(non_agg_data),]
non_agg_data <- non_agg_data[, alg := ifelse(alg=="ab", "ABTesting", ifelse(alg=="thomp","THOMP", ifelse(alg=="thomp_inf", "THOMP_INF", ifelse(alg=="thomp_athey", "HADAD", ifelse(alg=="thomp_bern", "THOMP", ifelse(alg=="thomp_inf_bern", "THOMP_INF",ifelse(alg=="ab_bern", "AB", ifelse(alg=="thomp_athey_bern", "HADAD",'NONE'))))))))]
group_outcome <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, group, x, ite)]
regret_mse <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, regret, ite, mean_mse, var_mse, x)]
table(non_agg_data$alg)
xlimit <- max(group_outcome$x) + 500
df <- copy(group_outcome)[ite==0,] [x<2001]
grp <- ggplot(df %>% filter(alg!='HADAD')) + geom_point(aes(x=x, y=factor(group)), shape=1, alpha=0.6) +
facet_grid(alg ~.) +
labs(x='Time Period', y = 'Group') +
theme(axis.text.y = element_text(size = rel(0.7)))  +  theme_bw()
ggsave("grp.png", dpi=400, height = 4, width=8, scale = 0.8)
grp
xlimit <- max(group_outcome$x) + 500
df <- copy(group_outcome)[ite==0,] [x<2001]
grp <- ggplot(df %>% filter(alg!='HADAD')) + geom_point(aes(x=x, y=factor(group)), shape=1, alpha=0.6) +
facet_grid(alg ~.) +
labs(x='Time Period', y = 'Group') +
theme(axis.text.y = element_text(size = rel(0.7)))  +  theme_bw()
ggsave("grp.png", dpi=400, height = 4, width=8, scale = 0.8)
grp
df_regret =  copy(regret_mse)[ite==0,]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=alg)) +
xlim(0,2400) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
df_mse <- copy(regret_mse)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
mn <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,2500) + ylim(0,0.03) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean')
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
mn
df_mse <- copy(regret_mse)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
var <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,2500) + ylim(0,0.01) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance')
var
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
# par(mfrow = c(1,2))
#
# ggsave("wise_mn_var.png", arrangeGrob(mn, var, nrow = 1, ncol=2),
#        dpi=400, height = 4, width=10, scale = 0.8)
df_regret =  copy(regret_mse)[ite==0,]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=alg)) +
xlim(0,2400) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
df_mse <- copy(regret_mse)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
mn <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,2500) + ylim(0,0.03) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean')
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
mn
df_mse <- copy(regret_mse)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
var <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,2500) + ylim(0,0.01) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance')
var
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
# par(mfrow = c(1,2))
#
# ggsave("wise_mn_var.png", arrangeGrob(mn, var, nrow = 1, ncol=2),
#        dpi=400, height = 4, width=10, scale = 0.8)
df_regret =  copy(regret_mse)[ite==0,]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=alg)) +
xlim(0,5500) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
df_mse <- copy(regret_mse)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
mn <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.03) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean')
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
mn
df_mse <- copy(regret_mse)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
var <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.01) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance')
var
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
# par(mfrow = c(1,2))
#
# ggsave("wise_mn_var.png", arrangeGrob(mn, var, nrow = 1, ncol=2),
#        dpi=400, height = 4, width=10, scale = 0.8)
df_regret = copy(regret_mse)[, .(regret = mean(regret), se = sd(regret)/sqrt(.N)),.(x, alg)]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=alg)) +
xlim(0,2400) + geom_ribbon(aes(ymin=regret-(1.96*se), ymax=regret+(1.96*se), group=alg), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
df_mse <- copy(regret_mse)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][, .(mse = mean(mse), se = sd(mse)/sqrt(.N)),.(x, alg)]
mn <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,2500) + ylim(0,0.03) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=alg), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean') + ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
mn
df_mse <- copy(regret_mse)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][, .(mse = mean(mse), se = sd(mse)/sqrt(.N)),.(x, alg)]
var <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,2500) + ylim(0,0.03) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=alg), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance') + ggsave("wise_var.png", dpi=400, height = 5, width=10, scale = 0.8)
var
# par(mfrow = c(1,2))
#
# ggsave("wise_mn_var.png", arrangeGrob(mn, var, nrow = 1, ncol=2),
#        dpi=400, height = 4, width=10, scale = 0.8)
df_regret = copy(regret_mse)[, .(regret = mean(regret), se = sd(regret)/sqrt(.N)),.(x, alg)]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=alg)) +
xlim(0,5500) + geom_ribbon(aes(ymin=regret-(1.96*se), ymax=regret+(1.96*se), group=alg), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
df_mse <- copy(regret_mse)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][, .(mse = mean(mse), se = sd(mse)/sqrt(.N)),.(x, alg)]
mn <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.03) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=alg), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean') + ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
mn
df_mse <- copy(regret_mse)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][, .(mse = mean(mse), se = sd(mse)/sqrt(.N)),.(x, alg)]
var <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.03) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=alg), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance') + ggsave("wise_var.png", dpi=400, height = 5, width=10, scale = 0.8)
var
# par(mfrow = c(1,2))
#
# ggsave("wise_mn_var.png", arrangeGrob(mn, var, nrow = 1, ncol=2),
#        dpi=400, height = 4, width=10, scale = 0.8)
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
xi = c(0.01, 0.05, 0.1, 0.15, 0.2, 0.5, 0.8, 1.1, 1.5)
main_df <- data.frame()
for (i in xi){
file_name = paste("xi_analysis", i, ".csv", sep="")
df <- fread("xi_analysis0.01.csv")
df <- df[, `:=`(xi=0.5, x= seq_len(.N))]
main_df <- rbind(main_df, df)
print(nrow(main_df))
}
suppressPackageStartupMessages(
{
library(ggplot2)
library(data.table)
require(gridExtra)
require(directlabels)
require(rcompanion)
library(dplyr)
})
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
xi = c(0.01, 0.05, 0.1, 0.15, 0.2, 0.5, 0.8, 1.1, 1.5)
main_df <- data.frame()
for (i in xi){
file_name = paste("xi_analysis", i, ".csv", sep="")
df <- fread("xi_analysis0.01.csv")
df <- df[, `:=`(xi=0.5, x= seq_len(.N))]
main_df <- rbind(main_df, df)
print(nrow(main_df))
}
# Setting new WD so that results are saved in different folder
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\plots")
ggplot(main_df[alg=='thomp_inf_bern',], aes(x=x, y=mean_mse)) + geom_line(aes(color=factor(xi))) +
xlim(0,12000) + ylim(0, 0.01) +
geom_dl(aes(label=xi), method=list('last.points', cex=0.5)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret')
#+
# ggsave("xi_analysis.png", dpi=400, height = 4, width=8, scale = 0.8)
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
xi = c(0.01, 0.05, 0.1, 0.15, 0.2, 0.5, 0.8, 1.1, 1.5)
main_df <- data.frame()
for (i in xi){
file_name = paste("xi_analysis", i, ".csv", sep="")
df <- fread("xi_analysis0.01.csv")
df <- df[, xi:=0.5][, x := seq_len(.N), .(ite)]
main_df <- rbind(main_df, df)
print(nrow(main_df))
}
# Setting new WD so that results are saved in different folder
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\plots")
ggplot(main_df[alg=='thomp_inf_bern',], aes(x=x, y=mean_mse)) + geom_line(aes(color=factor(xi))) +
xlim(0,12000) + ylim(0, 0.01) +
geom_dl(aes(label=xi), method=list('last.points', cex=0.5)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret')
suppressPackageStartupMessages(
{
library(ggplot2)
library(data.table)
require(gridExtra)
require(directlabels)
require(rcompanion)
library(dplyr)
})
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
xi = c(0.01, 0.05, 0.1, 0.15, 0.2, 0.5, 0.8, 1.1, 1.5)
main_xi_df <- data.frame()
for (i in xi){
file_name = paste("xi_analysis", i, ".csv", sep="")
df <- fread(file_name)
df <- df[, xi:=i][, x := seq_len(.N), .(ite)]
main_xi_df <- rbind(main_xi_df, df)
}
table(main_xi_df$xi)
# Setting new WD so that results are saved in different folder
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\plots")
one_ite <- main_xi_df[alg=='thomp_inf_bern' & ite==0,]
ggplot(one_ite, aes(x=x, y=regret)) + geom_line(aes(colour=factor(xi))) +
xlim(0,12000)+
geom_dl(aes(label=xi), method=list('last.points', cex=0.5)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret')
df_regret = copy(main_xi_df)[, .(regret = mean(regret), se = sd(regret)/sqrt(.N)),.(x, alg,xi)]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=xi)) +
xlim(0,12000) + geom_ribbon(aes(ymin=regret-(1.96*se), ymax=regret+(1.96*se), group=alg), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
table(main_xi_df$df_regret)
table(main_xi_df$alg)
ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=xi)) +
xlim(0,12000) + geom_ribbon(aes(ymin=regret-(1.96*se), ymax=regret+(1.96*se), group=xi), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=xi), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=factor(xi))) +
xlim(0,12000) + geom_ribbon(aes(ymin=regret-(1.96*se), ymax=regret+(1.96*se), group=xi), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=xi), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
max(main_xi_df$ite)
df_mse <- copy(main_xi_df)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][, .(mse = mean(mse), se = sd(mse)/sqrt(.N)),.(x, xi)]
ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=factor(xi))) +
xlim(0,12000) + ylim(0,0.03) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=xi), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=xi), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean') + ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=factor(xi))) +
xlim(0,12000) + ylim(0,0.005) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=xi), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=xi), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean') + ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
df_mse <- copy(main_xi_df)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][, .(mse = mean(mse), se = sd(mse)/sqrt(.N)),.(x, xi)]
df_mse <- copy(main_xi_df)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][, .(mse = mean(mse), se = sd(mse)/sqrt(.N)),.(x, xi)]
ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=xi)) +
xlim(0,12000) + ylim(0,0.01) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=xi), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=xi), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance') + ggsave("wise_var.png", dpi=400, height = 5, width=10, scale = 0.8)
ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=xi)) +
xlim(0,12000) + ylim(0,0.0025) + geom_ribbon(aes(ymin=mse-(1.96*se), ymax=mse+(1.96*se), group=xi), alpha=0.4,  fill="grey70") +
geom_dl(aes(label=xi), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance') + ggsave("wise_var.png", dpi=400, height = 5, width=10, scale = 0.8)
suppressPackageStartupMessages(
{
library(ggplot2)
library(data.table)
require(gridExtra)
require(directlabels)
require(rcompanion)
library(dplyr)
})
# knobs for analysis
group_allocations<-TRUE
single_ite_reg <- TRUE
xi_analysis <- TRUE
reg_order_analysis <- TRUE
seed_algs <- c("ab", "thomp", "thomp_inf")
est_algs <- c("thomp_ipw", "thomp_aipw", "thomp_eval_aipw",
"thomp_inf_ipw", "thomp_inf_aipw", "thomp_inf_eval_aipw")
#true_means <- c(0.25, 1.82, 1.48, 2.25, 2)
#true_vars = c(2.84, 1.97, 2.62, 1, 2.06)
#true_means <- c(1,1.5,2)
#
# true_means <- c(1, 1.1, 1.2)
# true_vars <- c(1/3, 1/3, 1/3)
# Bernoulli _means and vars
true_means <- c(0.157, 0.178, 0.199, 0.146, 0.129)
true_vars = c (0.132351, 0.146316, 0.159399, 0.124684, 0.112359)
grp = c(0:(length(true_means)-1))
true_df <- data.frame(grp, true_means, true_vars)
true_df <- true_df %>% mutate(grp=factor(grp))
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
non_agg_data <- fread("non_agg_bern_62_5000.csv")
# remove NA's
non_agg_data <- non_agg_data[complete.cases(non_agg_data),]
non_agg_data <- non_agg_data[, alg := ifelse(alg=="ab", "ABTesting", ifelse(alg=="thomp","THOMP", ifelse(alg=="thomp_inf", "THOMP_INF", ifelse(alg=="thomp_athey", "HADAD", ifelse(alg=="thomp_bern", "THOMP", ifelse(alg=="thomp_inf_bern", "THOMP_INF",ifelse(alg=="ab_bern", "AB", ifelse(alg=="thomp_athey_bern", "HADAD",'NONE'))))))))]
group_outcome <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, group, x, ite)]
regret_mse <- copy(non_agg_data)[, x:= seq_len(.N),.(ite,alg)][, .(alg, regret, ite, mean_mse, var_mse, x)]
xlimit <- max(group_outcome$x) + 500
df <- copy(group_outcome)[ite==5,] [x<2001]
grp <- ggplot(df %>% filter(alg!='HADAD')) + geom_point(aes(x=x, y=factor(group)), shape=1, alpha=0.6) +
facet_grid(alg ~.) +
labs(x='Time Period', y = 'Group') +
theme(axis.text.y = element_text(size = rel(0.7)))  +  theme_bw()
ggsave("grp.png", dpi=400, height = 4, width=8, scale = 0.8)
grp
setwd("G:\\My Drive\\Research\\Bandits\\code\\bandits\\analysis\\output")
xi = c(0.01, 0.05, 0.1, 0.15, 0.2, 0.5, 0.8, 1.1, 1.5)
main_xi_df <- data.frame()
for (i in xi){
file_name = paste("xi_analysis", i, ".csv", sep="")
df <- fread(file_name)
df <- df[, xi:=i][, x := seq_len(.N), .(ite)]
main_xi_df <- rbind(main_xi_df, df)
}
df_regret =  copy(regret_mse)[ite==0,]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=alg)) +
xlim(0,5500) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
df_mse <- copy(regret_mse)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
mn <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.03) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean')
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
mn
df_mse <- copy(regret_mse)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
var <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.01) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance')
var
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
# par(mfrow = c(1,2))
#
# ggsave("wise_mn_var.png", arrangeGrob(mn, var, nrow = 1, ncol=2),
#        dpi=400, height = 4, width=10, scale = 0.8)
df_regret =  copy(regret_mse)[ite==0,]
reg <- ggplot(df_regret, aes(x=x, y=regret)) + geom_line(aes(color=alg)) +
xlim(0,5500) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'Regret') +
ggsave("wise_reg.png", dpi=400, height = 4, width=8, scale = 0.8)
reg
df_mse <- copy(regret_mse)[, mse := mean_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
mn <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.01) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Mean')
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
mn
df_mse <- copy(regret_mse)[, mse := var_mse][, c('regret', 'var_mse', 'mean_mse'):=NULL][ite==0]
var <- ggplot(df_mse, aes(x=x, y=mse)) + geom_line(aes(color=alg)) +
xlim(0,5500) + ylim(0,0.0025) +
geom_dl(aes(label=alg), method=list('last.points', cex=0.8)) + theme_minimal() +
theme(legend.position = "none") +
labs(x='Time Period', y = 'MSE of Variance')
var
# ggsave("wise_mn.png", dpi=400, height = 5, width=10, scale = 0.8)
# par(mfrow = c(1,2))
#
# ggsave("wise_mn_var.png", arrangeGrob(mn, var, nrow = 1, ncol=2),
#        dpi=400, height = 4, width=10, scale = 0.8)
true_vars = true_means^2
0.37*0.37
true_vars = true_mean**2
true_vars = true_means**2
true_vars = true_means*2
true_means <- c(0.37098621, 0.33080171, 0.1699615 , 0.18902466, 0.6743146)
true_vars = true_means**2
library(data.table)
all_groups <- c(230093692,  200536689,  200125028,  140677387,  300087191,  300119049,  300548754,  230003647,  500101416,  430189943,  140429471,  430245919,  400409667,  140167347,  400004296,  140414252,  500034747,  530313109,  630171329,  140013280,  730251549,  730253729,  730102256,  730377210,  730377209,  800226038,  700028785,  200038119,  300433247,  400111426,  400447887,  400199133,  630133336,  140214352,  700038025,  700005721,  140178519,  300111472,  530018570,  700559994,  700130794,  140924045,  100056590,  300092826,  700561126,  700473227,  830308533,  130230060,  140435438,  140707906,  430133078,  530009761,  140671604,  500422079,  140435481,  600003643,  700072158,  700411959,  140008891,  730167855,  730033464,  700076666,  140130637,  800521172,  140188001,  330149182,  140134448,  140923893,  200229735,  200072537,  200412334,  330162920,  140257792,  500034001,  500003042,  500135110,  140020243)
silent_group <- c(100549097, 600072197, 500435896, 600117039, 140040012, 730286188, 400461849, 140007582, 300069093, 830248230, 200099584, 140188001, 300561954, 400021890, 200461334, 300092826, 330318779, 500532629, 140638967, 730102256, 400042838, 100550812, 530189789, 600561937, 140152570, 500105549, 140020186, 330052623, 300020359)
setwd('G:\\My Drive\\Research\\UMAA\\Code\\ml_model')
exclusion_list <- fread("exclusion_list.csv")
referred <- data.table(ID_DEMO = all_groups)
referred <- unique(referred)
main_tbl <- merge.data.table(exclusion_list, referred, all=FALSE)
silent_list <- fread("all_silent.csv")
referred <- data.table(ID_DEMO = all_groups)
referred <- unique(referred)
library(data.table)
all_groups <- c(230093692,  200536689,  200125028,  140677387,  300087191,  300119049,  300548754,  230003647,  500101416,  430189943,  140429471,  430245919,  400409667,  140167347,  400004296,  140414252,  500034747,  530313109,  630171329,  140013280,  730251549,  730253729,  730102256,  730377210,  730377209,  800226038,  700028785,  200038119,  300433247,  400111426,  400447887,  400199133,  630133336,  140214352,  700038025,  700005721,  140178519,  300111472,  530018570,  700559994,  700130794,  140924045,  100056590,  300092826,  700561126,  700473227,  830308533,  130230060,  140435438,  140707906,  430133078,  530009761,  140671604,  500422079,  140435481,  600003643,  700072158,  700411959,  140008891,  730167855,  730033464,  700076666,  140130637,  800521172,  140188001,  330149182,  140134448,  140923893,  200229735,  200072537,  200412334,  330162920,  140257792,  500034001,  500003042,  500135110,  140020243)
silent_group <- c(100549097, 600072197, 500435896, 600117039, 140040012, 730286188, 400461849, 140007582, 300069093, 830248230, 200099584, 140188001, 300561954, 400021890, 200461334, 300092826, 330318779, 500532629, 140638967, 730102256, 400042838, 100550812, 530189789, 600561937, 140152570, 500105549, 140020186, 330052623, 300020359)
setwd('G:\\My Drive\\Research\\UMAA\\Code\\ml_model')
exclusion_list <- fread("exclusion_list.csv")
silent_list <- fread("all_silent.csv")
referred <- data.table(ID_DEMO = all_groups)
referred <- unique(referred)
silent <- data.table(ID_DEMO = silent_group)
silent <- unique(silent)
View(referred)
View(silent)
total_list <- rbind(exclusion_list, silent_list)
new_memebrs <- rbind(referred, silent)
total_list <- rbind(exclusion_list, silent_list)
new_memebers <- rbind(referred, silent)
new_members <- rbind(referred, silent)
main_tbl <- merge.data.table(total_list, new_members, all=FALSE)
table(total_list$group)
library(data.table)
setwd('G:\\My Drive\\Research\\UMAA\\Code\\ml_model')
exclusion_list <- fread("exclusion_list.csv")
ml_data <- fread("valid_predict_proba.csv")
setwd('G:\\My Drive\\Research\\UMAA\\Data\\Pilot')
pilot_exclusion <- fread("pilot_exclusion_ids.csv")
ml_data <- ml_data[!ID_DEMO %in% pilot_exclusion$ID_DEMO][order(-prob)][, .(ID_DEMO, prob)][, rnk:=1:.N]
ml_40000 <- ml_data[rnk<=40000]
main_ml <- exclusion_list[group=='ml_group']
silent_ml <- ml_40000[!ID_DEMO %in% main_ml$ID_DEMO][, group:='silent_ml'][,.(ID_DEMO, group)]
control_group <- exclusion_list[group=='control_group']
all_silent <- rbind(silent_ml, control_group)
setwd('G:\\My Drive\\Research\\UMAA\\Code\\ml_model')
library(data.table)
all_groups <- c(230093692,  200536689,  200125028,  140677387,  300087191,  300119049,  300548754,  230003647,  500101416,  430189943,  140429471,  430245919,  400409667,  140167347,  400004296,  140414252,  500034747,  530313109,  630171329,  140013280,  730251549,  730253729,  730102256,  730377210,  730377209,  800226038,  700028785,  200038119,  300433247,  400111426,  400447887,  400199133,  630133336,  140214352,  700038025,  700005721,  140178519,  300111472,  530018570,  700559994,  700130794,  140924045,  100056590,  300092826,  700561126,  700473227,  830308533,  130230060,  140435438,  140707906,  430133078,  530009761,  140671604,  500422079,  140435481,  600003643,  700072158,  700411959,  140008891,  730167855,  730033464,  700076666,  140130637,  800521172,  140188001,  330149182,  140134448,  140923893,  200229735,  200072537,  200412334,  330162920,  140257792,  500034001,  500003042,  500135110,  140020243)
silent_group <- c(100549097, 600072197, 500435896, 600117039, 140040012, 730286188, 400461849, 140007582, 300069093, 830248230, 200099584, 140188001, 300561954, 400021890, 200461334, 300092826, 330318779, 500532629, 140638967, 730102256, 400042838, 100550812, 530189789, 600561937, 140152570, 500105549, 140020186, 330052623, 300020359)
setwd('G:\\My Drive\\Research\\UMAA\\Code\\ml_model')
exclusion_list <- fread("exclusion_list.csv")
silent_list <- fread("all_silent.csv")
id_email <- c(230093692,  200536689,  200125028,  140677387,  300087191,  300119049,  300548754,  230003647,  500101416,  430189943,  140429471,  430245919,  400409667,  140167347,  400004296,  140414252,  500034747,  530313109,  630171329,  140013280,  730251549,  730253729,  730102256,  730377210,  730377209,  800226038,  700028785,  200038119,  300433247,  400111426,  400447887,  400199133,  630133336,  140214352,  700038025,  700005721,  140178519,  300111472,  530018570,  700559994,  700130794,  140924045,  100056590,  300092826,  700561126,  700473227,  830308533,  130230060,  140435438,  140707906,  430133078,  530009761,  140671604,  500422079,  140435481,  600003643,  700072158,  700411959,  140008891,  730167855,  730033464,  700076666,  140130637,  800521172,  140188001,  330149182,  140134448,  140923893,  200229735,  200072537,  200412334,  330162920,  140257792,  500034001,  500003042,  500135110,  140020243)
id_silent <- c(100549097, 600072197, 500435896, 600117039, 140040012, 730286188, 400461849, 140007582, 300069093, 830248230, 200099584, 140188001, 300561954, 400021890, 200461334, 300092826, 330318779, 500532629, 140638967, 730102256, 400042838, 100550812, 530189789, 600561937, 140152570, 500105549, 140020186, 330052623, 300020359)
setwd('G:\\My Drive\\Research\\UMAA\\Code\\ml_model')
exclusion_list <- fread("exclusion_list.csv")
silent_list <- fread("all_silent.csv")
View(silent_list)
all_groups <- rbind(exclusion_list, silent_ml_list)
library(data.table)
id_email <- c(230093692,  200536689,  200125028,  140677387,  300087191,  300119049,  300548754,  230003647,  500101416,  430189943,  140429471,  430245919,  400409667,  140167347,  400004296,  140414252,  500034747,  530313109,  630171329,  140013280,  730251549,  730253729,  730102256,  730377210,  730377209,  800226038,  700028785,  200038119,  300433247,  400111426,  400447887,  400199133,  630133336,  140214352,  700038025,  700005721,  140178519,  300111472,  530018570,  700559994,  700130794,  140924045,  100056590,  300092826,  700561126,  700473227,  830308533,  130230060,  140435438,  140707906,  430133078,  530009761,  140671604,  500422079,  140435481,  600003643,  700072158,  700411959,  140008891,  730167855,  730033464,  700076666,  140130637,  800521172,  140188001,  330149182,  140134448,  140923893,  200229735,  200072537,  200412334,  330162920,  140257792,  500034001,  500003042,  500135110,  140020243)
id_silent <- c(100549097, 600072197, 500435896, 600117039, 140040012, 730286188, 400461849, 140007582, 300069093, 830248230, 200099584, 140188001, 300561954, 400021890, 200461334, 300092826, 330318779, 500532629, 140638967, 730102256, 400042838, 100550812, 530189789, 600561937, 140152570, 500105549, 140020186, 330052623, 300020359)
setwd('G:\\My Drive\\Research\\UMAA\\Code\\ml_model')
exclusion_list <- fread("exclusion_list.csv")
silent_list <- fread("all_silent.csv")
silent_ml_list <- silent_list[group=='silent_ml']
all_groups <- rbind(exclusion_list, silent_ml_list)
emain_converts <- data.table(ID_DEMO = id_email)
emain_converts <- unique(emain_converts)
silent_converts <- data.table(ID_DEMO = id_silent)
silent_converts <- unique(silent_converts)
new_members <- rbind(emain_converts, silent_converts)
main_tbl <- merge.data.table(all_groups, new_members, all=FALSE)
table(all_groups$group)
table(main_tbl$group)
prop.test(c(59, 32), c(19985, 20015), , alternative = c("greater"))
prop.test(c(59, 32), c(19985, 20015), alternative = c("greater"))
